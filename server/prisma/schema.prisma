generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Area {
  id        BigInt    @id @default(autoincrement())
  name      String    @unique @map("name") @db.VarChar(255)
  createdAt DateTime? @default(now()) @map("created_at") @db.Timestamp(0)
  processes Process[]

  @@map("area")
}

model Process {
  id            BigInt        @id @default(autoincrement())
  name          String        @db.VarChar(255)
  description   String?       @db.Text
  documentation String?       @db.VarChar(255)
  tools         String?       @db.VarChar(255)
  areaId        BigInt        @map("area_id")
  parentId      BigInt?       @map("parent_id")
  createdAt     DateTime?     @default(now()) @map("created_at") @db.Timestamp(0)
  area          Area          @relation(fields: [areaId], references: [id], onDelete: Cascade, map: "processes_ibfk_1")
  parent        Process?      @relation("ProcessToProcess", fields: [parentId], references: [id], onDelete: Cascade, map: "processes_ibfk_2")
  children      Process[]     @relation("ProcessToProcess")
  responsibles  Responsible[]

  @@index([areaId], map: "processes_ibfk_1")
  @@index([parentId], map: "processes_ibfk_2")
  @@map("process")
}

model DepartmentSector {
  id           BigInt             @id @default(autoincrement())
  name         String             @db.VarChar(255)
  departmentId BigInt?            @map("department_id")
  createdAt    DateTime?          @default(now()) @map("created_at") @db.Timestamp(0)
  parent       DepartmentSector?  @relation("DepartmentToDepartment", fields: [departmentId], references: [id], onDelete: Cascade, map: "departments_sectors_ibfk_1")
  children     DepartmentSector[] @relation("DepartmentToDepartment")
  responsibles Responsible[]

  @@index([departmentId], map: "departments_sectors_ibfk_1")
  @@map("department_sector")
}

model Responsible {
  processId          BigInt           @map("process_id")
  departmentSectorId BigInt           @map("department_sector_id")
  createdAt          DateTime?        @default(now()) @map("created_at") @db.Timestamp(0)
  process            Process          @relation(fields: [processId], references: [id], onDelete: Cascade, map: "responsibles_ibfk_1")
  departmentSector   DepartmentSector @relation(fields: [departmentSectorId], references: [id], onDelete: Cascade, map: "responsibles_ibfk_2")

  @@id([processId, departmentSectorId])
  @@index([departmentSectorId], map: "responsibles_ibfk_2")
  @@map("responsible")
}
